
local Settings = {
    Integer = {
        ["StudDelay"] = 0.05,
        ["PickupDelay"] = 0.5,
        ["FlySpeed"] = 50,
        ["StandPilotSpeed"] = 50,
        ["StandPilotJumpPower"] = 50,
        ["ESPTextSize"] = 14,
        ["NametagTextSize"] = 14,
        ["FogDensity"] = 0.75,
    },
    State = {
        ["ItemFarm"] = false,
        ["NoClip"] = false,
        ["Traveling"] = false,
        ["Invisibility"] = false,
        ["InstantPickup"] = false,
        ["Fly"] = false,
        ["ItemESP"] = false,
        ["Nametags"] = false,
        ["PlayerChams"] = false,
        ["StandPilot"] = false,
        ["AutoSteal"] = false,
        ["NPCFarm"] = false,
        ["AutoArcade"] = false,
    },
    String = {
        ["ESPFont"] = "GothamBold",
        ["NametagFont"] = "GothamBold",
        ["StandPilotMode"] = "CFrame",
    },
    Color = {
        ["NametagColor"] = Color3.fromRGB(255, 255, 255),
    },
    Bool = {
        ["ESPShowDistance"] = true,
        ["NametagShowDistance"] = true,
    },
    Table = {
        ["SelectedItemFarm"] = {},
        ["ESPObjects"] = {},
        ["SelectedESPItems"] = {},
        ["Nametags"] = {},
        ["NametagConnections"] = {},
        ["PlayerChams"] = {},
        ["PlayerChamsConnections"] = {},
        ["StandPilotKeys"] = {W = 0, A = 0, S = 0, D = 0},
        ["SelectedNPCs"] = {},
        ["AllNPCsList"] = {
            "Alpha Thug",
            "Bucciarati",
            "Corrupt Police",
            "Diavolo",
            "Dio",
            "Fugo",
            "Ghiaccio",
            "Heaven Ascension Dio",
            "Jotaro Kujo",
            "Jotaro",
            "Leaky Eye Luca",
            "Pesci",
            "Security Guard",
            "Thug",
            "Vampire",
            "Zombie Henchman"
        },
        ["MaxItems"] = {
            ["Diamond"] = 25,
            ["Clackers"] = 10,
            ["Rokakaka"] = 25,
            ["Gold Coin"] = 45,
            ["Stone Mask"] = 10,
            ["Steel Ball"] = 10,
            ["Dio's Diary"] = 10,
            ["Lucky Arrow"] = 10,
            ["Pure Rokakaka"] = 10,
            ["Zeppeli's Hat"] = 10,
            ["Ancient Scroll"] = 10,
            ["Lucky Stone Mask"] = 10,
            ["Mysterious Arrow"] = 25,
            ["Caesar's Headband"] = 10,
            ["Quinton's Glove"] = 10;
            ["Rib Cage of The Saint's Corpse"] = 20,
        },
        ["MaxAutoBuy"] = {
            ["Rokakaka"] = 24,
            ["Dio's Diary"] = 9,
            ["Lucky Arrow"] = 9,
            ["Pure Rokakaka"] = 9,
            ["Mysterious Arrow"] = 24,
            ["Heart of the Saint's Corpse"] = 9;
            ["Pelvis of the Saint's Corpse"] = 9;
            ["Left Arm of the Saint's Corpse"] = 9;
            ["Rib Cage of The Saint's Corpse"] = 19,
        }
    },
}

local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local StarterGui = game:GetService("StarterGui")
local UserInputService = game:GetService("UserInputService")

local LocalPlayer = Players.LocalPlayer

local Watermelon = {}

function Watermelon.EnableNoClip()
    if Settings.State.NoClip then return end
    Settings.State.NoClip = true
    Settings.Table.NoClipConnection = RunService.Stepped:Connect(function()
        local char = LocalPlayer.Character
        if not char then return end
        for _, part in ipairs(char:GetDescendants()) do
            if part:IsA("BasePart") then
                part.CanCollide = false
            end
        end
    end)
end

function Watermelon.DisableNoClip()
    if not Settings.State.NoClip then return end
    Settings.State.NoClip = false
    if Settings.Table.NoClipConnection then
        Settings.Table.NoClipConnection:Disconnect()
        Settings.Table.NoClipConnection = nil
    end
end

function Watermelon.StopTravel()
    Settings.State.Traveling = false
end

function Watermelon.Teleport(target)
    local char = LocalPlayer.Character
    if not char or not char.HumanoidRootPart then return end
    
    local hrp = char.HumanoidRootPart
    local targetPos = typeof(target) == "Vector3" and target or target.Position
    
    Watermelon.EnableNoClip()
    
    if not Settings.Table.Platform or not Settings.Table.Platform.Parent then
        Settings.Table.Platform = Instance.new("Part")
        Settings.Table.Platform.Size = Vector3.new(8, 1, 8)
        Settings.Table.Platform.Anchored = true
        Settings.Table.Platform.CanCollide = true
        Settings.Table.Platform.Transparency = 1
        Settings.Table.Platform.Parent = workspace
    end
    
    Settings.State.Traveling = true
    
    while Settings.State.Traveling do
        if not hrp.Parent or not char.Parent then break end
        
        local distance = (targetPos - hrp.Position).Magnitude
        if distance <= 49 then
            hrp.CFrame = CFrame.new(targetPos)
            if Settings.Table.Platform and Settings.Table.Platform.Parent then
                Settings.Table.Platform.CFrame = CFrame.new(targetPos.X, targetPos.Y - 3.5, targetPos.Z)
            end
            break
        end
        
        local nextPos = hrp.Position + (targetPos - hrp.Position).Unit * 49
        hrp.CFrame = CFrame.new(nextPos)
        if Settings.Table.Platform and Settings.Table.Platform.Parent then
            Settings.Table.Platform.CFrame = CFrame.new(nextPos.X, nextPos.Y - 3.5, nextPos.Z)
        end
        
        wait(Settings.Integer.StudDelay)
    end
    
    Settings.State.Traveling = false
    Watermelon.DisableNoClip()
end

function Watermelon.TeleportToRandom()
    local randomX = math.random(-590, 590)
    local randomZ = math.random(-520, 530)
    Watermelon.Teleport(Vector3.new(randomX, 100, randomZ))
end

function Watermelon.EnableCamera()
    workspace.CurrentCamera.CameraType = Enum.CameraType.Custom
    Settings.Table.CameraConnection = RunService.RenderStepped:Connect(function()
        if Settings.State.ItemFarm and LocalPlayer.Character then
            local hrp = LocalPlayer.Character:FindFirstChild("HumanoidRootPart")
            if hrp then
                workspace.CurrentCamera.CFrame = CFrame.new(hrp.Position + Vector3.new(0, 25, 0), hrp.Position)
            end
        end
    end)
end

function Watermelon.DisableCamera()
    if Settings.Table.CameraConnection then
        Settings.Table.CameraConnection:Disconnect()
        Settings.Table.CameraConnection = nil
    end
end

function Watermelon.PlayAnimation(AnimationID, AnimationSpeed, Time)
    local anim = Instance.new("Animation")
    anim.AnimationId = AnimationID
    local humanoid = LocalPlayer.Character:WaitForChild("Humanoid")
    local animator = humanoid:FindFirstChild("Animator") or humanoid:WaitForChild("Animator", 3)
    local track = animator:LoadAnimation(anim)
    track:Play()
    track:AdjustSpeed(AnimationSpeed)
    track.Priority = Enum.AnimationPriority.Action4
    track.TimePosition = Time
    return track
end

function Watermelon.EnableInvisibility()
    if Settings.State.Invisibility then return end
    local char = LocalPlayer.Character
    if not char then return end
    
    local HUD = LocalPlayer.PlayerGui:FindFirstChild("HUD")
    if HUD then HUD.Parent = StarterGui end
    
    Settings.Table.UndergroundAnimation = Watermelon.PlayAnimation("rbxassetid://7189062263", 0, 5)
    LocalPlayer.Character = nil
    Settings.Table.UndergroundAnimation:Stop()
    LocalPlayer.Character = char
    
    pcall(function() StarterGui:FindFirstChild("HUD").Parent = LocalPlayer.PlayerGui end)
    
    local color = Color3.fromRGB(255, 255, 255)
    Settings.Table.InvisHighlight = Instance.new("Highlight")
    Settings.Table.InvisHighlight.Parent = char
    Settings.Table.InvisHighlight.FillColor = color
    Settings.Table.InvisHighlight.OutlineColor = Color3.new(color.R * 0.7, color.G * 0.7, color.B * 0.7)
    Settings.Table.InvisHighlight.FillTransparency = 0.5
    
    Settings.Table.OriginalColors = {}
    for _, part in char:GetChildren() do
        if part:IsA("BasePart") then
            Settings.Table.OriginalColors[part] = {Color = part.Color, Material = part.Material}
            part.Material = Enum.Material.ForceField
            part.Color = color
        end
    end
    
    Settings.State.Invisibility = true
end

function Watermelon.DisableInvisibility()
    if not Settings.State.Invisibility then return end
    local char = LocalPlayer.Character
    if not char then 
        Settings.State.Invisibility = false
        return 
    end
    
    Watermelon.PlayAnimation("rbxassetid://7189062263", 0, 5):Stop()
    if Settings.Table.InvisHighlight then
        Settings.Table.InvisHighlight:Destroy()
        Settings.Table.InvisHighlight = nil
    end
    
    for part, original in pairs(Settings.Table.OriginalColors or {}) do
        if part:IsA("BasePart") then
            part.Material = original.Material
            part.Color = original.Color
        end
    end
    Settings.Table.OriginalColors = {}
    Settings.State.Invisibility = false
end

function Watermelon.StartFly()
    local keys = {W = 0, A = 0, S = 0, D = 0}
    local keyInfo = {W = {"+", "LookVector"}, A = {"-", "RightVector"}, S = {"-", "LookVector"}, D = {"+", "RightVector"}}
    
    local hrp = LocalPlayer.Character.HumanoidRootPart
    Settings.Table.FlyBodyVelocity = Instance.new("BodyVelocity")
    Settings.Table.FlyBodyVelocity.MaxForce = Vector3.new(math.huge, math.huge, math.huge)
    Settings.Table.FlyBodyVelocity.Velocity = Vector3.zero
    Settings.Table.FlyBodyVelocity.Parent = hrp
    Settings.Table.FlyBodyGyro = Instance.new("BodyGyro")
    Settings.Table.FlyBodyGyro.MaxTorque = Vector3.new(math.huge, math.huge, math.huge)
    Settings.Table.FlyBodyGyro.P = 9e4
    Settings.Table.FlyBodyGyro.Parent = hrp
    
    Settings.Table.FlyInputBegan = UserInputService.InputBegan:Connect(function(k, t)
        if not t and keys[k.KeyCode.Name] then keys[k.KeyCode.Name] = 1 end
    end)
    Settings.Table.FlyInputEnded = UserInputService.InputEnded:Connect(function(k, t)
        if not t and keys[k.KeyCode.Name] then keys[k.KeyCode.Name] = 0 end
    end)
    
    RunService:BindToRenderStep("Fly", 0, function()
        local char = LocalPlayer.Character
        if not char then return end
        local hrp, hum = char:FindFirstChild("HumanoidRootPart"), char:FindFirstChild("Humanoid")
        if not hrp or not hum then return end
        hum.WalkSpeed, hum.JumpPower = 0, 0
        
        local cam = workspace.CurrentCamera.CFrame
        local vel = Vector3.zero
        
        for k, v in keys do
            if v == 1 then
                local dir = cam[keyInfo[k][2]]
                local mult = Settings.Integer.FlySpeed * 1.2
                vel = keyInfo[k][1] == "+" and vel + dir * mult or vel - dir * mult
            end
        end
        
        Settings.Table.FlyBodyGyro.CFrame = CFrame.new(hrp.Position, hrp.Position + cam.LookVector)
        Settings.Table.FlyBodyVelocity.Velocity = vel
    end)
end

function Watermelon.StopFly()
    RunService:UnbindFromRenderStep("Fly")
    if Settings.Table.FlyInputBegan then Settings.Table.FlyInputBegan:Disconnect() Settings.Table.FlyInputBegan = nil end
    if Settings.Table.FlyInputEnded then Settings.Table.FlyInputEnded:Disconnect() Settings.Table.FlyInputEnded = nil end
    if Settings.Table.FlyBodyVelocity then Settings.Table.FlyBodyVelocity:Destroy() Settings.Table.FlyBodyVelocity = nil end
    if Settings.Table.FlyBodyGyro then Settings.Table.FlyBodyGyro:Destroy() Settings.Table.FlyBodyGyro = nil end
    local hum = LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("Humanoid")
    if hum then hum.WalkSpeed, hum.JumpPower = 16, 50 end
end

function Watermelon.EnableInstantPickup()
    local container = workspace.Item_Spawns.Items
    for _, v in pairs(container:GetChildren()) do
        local prox = v:FindFirstChild("ProximityPrompt")
        if prox then prox.HoldDuration = 0 end
    end
    Settings.Table.InstantPickupConnection = container.ChildAdded:Connect(function(v)
        task.wait(0.05)
        local prox = v:FindFirstChild("ProximityPrompt")
        if prox then prox.HoldDuration = 0 end
    end)
end

function Watermelon.DisableInstantPickup()
    if Settings.Table.InstantPickupConnection then
        Settings.Table.InstantPickupConnection:Disconnect()
        Settings.Table.InstantPickupConnection = nil
    end
end

function Watermelon.CountItem(itemName)
    local count = 0
    for _, item in pairs(LocalPlayer.Backpack:GetChildren()) do
        if item.Name == itemName then
            count = count + 1
        end
    end
    if LocalPlayer.Character then
        for _, item in pairs(LocalPlayer.Character:GetChildren()) do
            if item:IsA("Tool") and item.Name == itemName then
                count = count + 1
            end
        end
    end
    return count
end

function Watermelon.IsMax(itemName)
    local maxAmount = Settings.Table.MaxItems[itemName] or 999
    return Watermelon.CountItem(itemName) >= maxAmount
end

function Watermelon.Sell(itemName)
    local item = LocalPlayer.Backpack:FindFirstChild(itemName)
    if not item and LocalPlayer.Character then
        item = LocalPlayer.Character:FindFirstChild(itemName)
    end
    if not item then return false end
    
    LocalPlayer.Character.Humanoid:EquipTool(item)

    LocalPlayer.Character.RemoteEvent:FireServer("EndDialogue", {
        NPC = "Merchant",
        Option = "Option2",
        Dialogue = "Dialogue5"
    })
    
    return true
end

function Watermelon.FindNearestItem(selectedItems)
    local hrp = LocalPlayer.Character and LocalPlayer.Character.HumanoidRootPart
    if not hrp then return nil end
    
    local nearest, minDist = nil, math.huge
    
    for _, v in pairs(workspace.Item_Spawns.Items:GetChildren()) do
        local itemPart = v:FindFirstChildOfClass("MeshPart") or v:FindFirstChildOfClass("Part")
        local prox = v:FindFirstChild("ProximityPrompt")
        
        if itemPart and prox and itemPart.Transparency < 1 then
            local isSelected = #selectedItems == 0 or table.find(selectedItems, prox.ObjectText)
            if isSelected then
                local dist = (itemPart.Position - hrp.Position).Magnitude
                if dist < minDist then
                    minDist = dist
                    nearest = v
                end
            end
        end
    end
    
    return nearest
end

function Watermelon.Collect(itemName)
    if not itemName then return false end
    
    local hrp = LocalPlayer.Character and LocalPlayer.Character.HumanoidRootPart
    if not hrp then return false end
    
    local oldPos = hrp.CFrame
    local wasInvisible = Settings.State.Invisibility
    
    if not wasInvisible then
        Watermelon.EnableInvisibility()
    end
    
    local found = nil
    
    while not found do
        for _, v in pairs(workspace.Item_Spawns.Items:GetChildren()) do
            local prox = v:FindFirstChild("ProximityPrompt")
            if prox and prox.ObjectText == itemName then
                local itemPart = v:FindFirstChildOfClass("MeshPart") or v:FindFirstChildOfClass("Part")
                if itemPart and itemPart.Transparency < 1 then
                    found = v
                    break
                end
            end
        end
        
        if not found then
            Watermelon.TeleportToRandom()
            task.wait()
        end
    end
    
    local itemPart = found:FindFirstChildOfClass("MeshPart") or found:FindFirstChildOfClass("Part")
    local proxPrompt = found:FindFirstChild("ProximityPrompt")
    
    if Watermelon.IsMax(itemName) then
        Watermelon.Sell(itemName)
    end
    
    proxPrompt.HoldDuration = 0
    
    Watermelon.Teleport(itemPart)
    wait(Settings.Integer.PickupDelay)
    
    fireproximityprompt(proxPrompt)
    wait(0.5)
    
    Watermelon.Teleport(oldPos.Position)
    
    if not wasInvisible then
        Watermelon.DisableInvisibility()
    end
    
    Library.SendNotification({
        title = "Collect",
        text = itemName .. " collected!",
        duration = 5
    })
    
    return true
end

function Watermelon.GetItemName(item)
    local prox = item:FindFirstChildOfClass("ProximityPrompt", true)
    return prox and prox.ObjectText or nil
end

function Watermelon.GetDistance(part)
    local hrp = LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("HumanoidRootPart")
    if not hrp then return 0 end
    return math.round((hrp.Position - part.Position).Magnitude)
end

function Watermelon.CreateESP(item, name)
    if not item.PrimaryPart then return end
    
    local colors = {
        ["Diamond"] = Color3.fromRGB(100, 200, 255),
        ["Gold Coin"] = Color3.fromRGB(255, 215, 0),
        ["Mysterious Arrow"] = Color3.fromRGB(245, 222, 179),
        ["Pure Rokakaka"] = Color3.fromRGB(255, 100, 100),
        ["Rokakaka"] = Color3.fromRGB(220, 20, 60),
        ["Stone Mask"] = Color3.fromRGB(169, 169, 169),
        ["Rib Cage of The Saint's Corpse"] = Color3.fromRGB(211, 211, 211),
        ["Steel Ball"] = Color3.fromRGB(50, 205, 50),
        ["Ancient Scroll"] = Color3.fromRGB(255, 239, 213),
        ["Dio's Diary"] = Color3.fromRGB(139, 69, 19),
        ["Caesar's Headband"] = Color3.fromRGB(255, 140, 0),
        ["Quinton's Glove"] = Color3.fromRGB(178, 34, 34),
        ["Lucky Arrow"] = Color3.fromRGB(255, 255, 255),
        ["Lucky Stone Mask"] = Color3.fromRGB(255, 255, 255),
        ["Clackers"] = Color3.fromRGB(255, 165, 0),
        ["Zeppeli's Hat"] = Color3.fromRGB(139, 69, 19),
        ["Christmas Present"] = Color3.fromRGB(255, 0, 0)
    }
    
    local box = Instance.new("Part")
    box.Name = "ESPBox"
    box.Size = Vector3.new(1.5, 1.5, 1.5)
    box.CFrame = item.PrimaryPart.CFrame
    box.Anchored = true
    box.CanCollide = false
    box.Material = Enum.Material.ForceField
    box.Color = colors[name] or Color3.fromRGB(255, 255, 255)
    box.Transparency = 0.5
    box.Parent = item
    
    local bb = Instance.new("BillboardGui")
    bb.Parent = item.PrimaryPart
    bb.AlwaysOnTop = true
    bb.Size = UDim2.new(0, 200, 0, 50)
    bb.StudsOffset = Vector3.new(0, 2, 0)
    bb.Enabled = false
    
    local lbl = Instance.new("TextLabel")
    lbl.Parent = bb
    lbl.Size = UDim2.new(1, 0, 1, 0)
    lbl.BackgroundTransparency = 1
    lbl.Text = name
    lbl.TextColor3 = colors[name] or Color3.fromRGB(255, 255, 255)
    lbl.TextStrokeTransparency = 0
    lbl.TextSize = Settings.Integer.ESPTextSize
    lbl.Font = Enum.Font[Settings.String.ESPFont]
    
    table.insert(Settings.Table.ESPObjects, {Box = box, Billboard = bb, Label = lbl, Item = item, Name = name})
    
    task.spawn(function()
        while item.Parent and item.PrimaryPart do
            task.wait()
            box.CFrame = item.PrimaryPart.CFrame
            if table.find(Settings.Table.SelectedESPItems, name) and Settings.State.ItemESP then
                box.Transparency = 0.5
                bb.Enabled = true
                if Settings.Bool.ESPShowDistance then
                    lbl.Text = name .. " [" .. Watermelon.GetDistance(item.PrimaryPart) .. "m]"
                else
                    lbl.Text = name
                end
                lbl.TextSize = Settings.Integer.ESPTextSize
                lbl.Font = Enum.Font[Settings.String.ESPFont]
            else
                box.Transparency = 1
                bb.Enabled = false
            end
        end
        box:Destroy()
        bb:Destroy()
        for i, d in ipairs(Settings.Table.ESPObjects) do
            if d.Item == item then
                table.remove(Settings.Table.ESPObjects, i)
                break
            end
        end
    end)
end

function Watermelon.EnableItemESP()
    Settings.State.ItemESP = true
    
    for _, item in workspace.Item_Spawns.Items:GetChildren() do
        local exists = false
        for _, d in ipairs(Settings.Table.ESPObjects) do
            if d.Item == item then exists = true break end
        end
        if not exists then
            local name = Watermelon.GetItemName(item)
            if name then
                item.Name = name
                Watermelon.CreateESP(item, name)
            end
        end
    end
    
    Settings.Table.ESPConnection = workspace.Item_Spawns.Items.ChildAdded:Connect(function(item)
        task.wait(0.1)
        if Settings.State.ItemESP then
            local name = Watermelon.GetItemName(item)
            if name then
                item.Name = name
                Watermelon.CreateESP(item, name)
            end
        end
    end)
end

function Watermelon.DisableItemESP()
    Settings.State.ItemESP = false
    
    if Settings.Table.ESPConnection then
        Settings.Table.ESPConnection:Disconnect()
        Settings.Table.ESPConnection = nil
    end
    
    for _, d in ipairs(Settings.Table.ESPObjects) do
        if d.Box then d.Box:Destroy() end
        if d.Billboard then d.Billboard:Destroy() end
    end
    Settings.Table.ESPObjects = {}
end

function Watermelon.CreateNametag(player)
    if player == LocalPlayer then return end
    
    local function AddTag(char)
        if not Settings.State.Nametags then return end
        
        if Settings.Table.Nametags[player] then
            Settings.Table.Nametags[player].Billboard:Destroy()
        end
        
        local hrp = char:WaitForChild("HumanoidRootPart", 5)
        if not hrp then return end
        
        local bb = Instance.new("BillboardGui")
        bb.AlwaysOnTop = true
        bb.Size = UDim2.new(0, 200, 0, 50)
        bb.StudsOffset = Vector3.new(0, 3, 0)
        bb.Parent = hrp
        
        local lbl = Instance.new("TextLabel")
        lbl.Size = UDim2.new(1, 0, 1, 0)
        lbl.BackgroundTransparency = 1
        lbl.Text = player.Name
        lbl.TextColor3 = Settings.Color.NametagColor
        lbl.TextStrokeTransparency = 0
        lbl.TextSize = Settings.Integer.NametagTextSize
        lbl.Font = Enum.Font[Settings.String.NametagFont]
        lbl.Parent = bb
        
        Settings.Table.Nametags[player] = {Billboard = bb, Label = lbl, Character = char}
    end
    
    if player.Character then
        AddTag(player.Character)
    end
    
    local conn = player.CharacterAdded:Connect(function(char)
        if Settings.State.Nametags then
            task.wait(0.1)
            AddTag(char)
        end
    end)
    
    Settings.Table.NametagConnections[player] = conn
end

function Watermelon.UpdateNametags()
    for player, d in pairs(Settings.Table.Nametags) do
        if not player.Parent or not d.Character or not d.Character.Parent then
            if d.Billboard then d.Billboard:Destroy() end
            Settings.Table.Nametags[player] = nil
            continue
        end
        
        local hum = d.Character:FindFirstChild("Humanoid")
        if not hum or hum.Health <= 0 then
            d.Billboard.Enabled = false
            continue
        end
        
        local hrp = d.Character:FindFirstChild("HumanoidRootPart")
        if hrp and Settings.State.Nametags then
            d.Billboard.Enabled = true
            if Settings.Bool.NametagShowDistance then
                d.Label.Text = player.Name .. " [" .. Watermelon.GetDistance(hrp) .. "m]"
            else
                d.Label.Text = player.Name
            end
            d.Label.TextColor3 = Settings.Color.NametagColor
            d.Label.TextSize = Settings.Integer.NametagTextSize
            d.Label.Font = Enum.Font[Settings.String.NametagFont]
        else
            d.Billboard.Enabled = false
        end
    end
end

function Watermelon.EnableNametags()
    Settings.State.Nametags = true
    
    for _, p in Players:GetPlayers() do
        if p ~= LocalPlayer then
            Watermelon.CreateNametag(p)
        end
    end
    
    Settings.Table.NametagPlayerAdded = Players.PlayerAdded:Connect(function(p)
        if p ~= LocalPlayer then
            Watermelon.CreateNametag(p)
        end
    end)
    
    Settings.Table.NametagPlayerRemoving = Players.PlayerRemoving:Connect(function(p)
        if Settings.Table.Nametags[p] then
            Settings.Table.Nametags[p].Billboard:Destroy()
            Settings.Table.Nametags[p] = nil
        end
    end)
    
    Settings.Table.NametagUpdate = RunService.Heartbeat:Connect(function()
        if Settings.State.Nametags then
            Watermelon.UpdateNametags()
        end
    end)
end

function Watermelon.DisableNametags()
    Settings.State.Nametags = false
    
    if Settings.Table.NametagPlayerAdded then
        Settings.Table.NametagPlayerAdded:Disconnect()
        Settings.Table.NametagPlayerAdded = nil
    end
    if Settings.Table.NametagPlayerRemoving then
        Settings.Table.NametagPlayerRemoving:Disconnect()
        Settings.Table.NametagPlayerRemoving = nil
    end
    if Settings.Table.NametagUpdate then
        Settings.Table.NametagUpdate:Disconnect()
        Settings.Table.NametagUpdate = nil
    end
    
    for p, d in pairs(Settings.Table.Nametags) do
        if d.Billboard then d.Billboard:Destroy() end
        Settings.Table.Nametags[p] = nil
    end
    
    for p, conn in pairs(Settings.Table.NametagConnections) do
        if conn then conn:Disconnect() end
        Settings.Table.NametagConnections[p] = nil
    end
end

function Watermelon.CreatePlayerChams(player)
    if player == LocalPlayer then return end
    
    local function AddChams(char)
        if not Settings.State.PlayerChams then return end
        
        if Settings.Table.PlayerChams[player] then
            Settings.Table.PlayerChams[player]:Destroy()
        end
        
        local h = Instance.new("Highlight")
        h.FillColor = Color3.fromRGB(255, 255, 255)
        h.OutlineColor = Color3.fromRGB(255, 255, 255)
        h.FillTransparency = 0
        h.OutlineTransparency = 0
        h.Adornee = char
        h.Parent = char
        
        Settings.Table.PlayerChams[player] = h
    end
    
    if player.Character then
        AddChams(player.Character)
    end
    
    local conn = player.CharacterAdded:Connect(function(char)
        if Settings.State.PlayerChams then
            task.wait(0.1)
            AddChams(char)
        end
    end)
    
    Settings.Table.PlayerChamsConnections[player] = conn
end

function Watermelon.EnablePlayerChams()
    Settings.State.PlayerChams = true
    
    for _, p in Players:GetPlayers() do
        if p ~= LocalPlayer then
            Watermelon.CreatePlayerChams(p)
        end
    end
    
    Settings.Table.ChamsPlayerAdded = Players.PlayerAdded:Connect(function(p)
        if p ~= LocalPlayer then
            Watermelon.CreatePlayerChams(p)
        end
    end)
    
    Settings.Table.ChamsPlayerRemoving = Players.PlayerRemoving:Connect(function(p)
        if Settings.Table.PlayerChams[p] then
            Settings.Table.PlayerChams[p]:Destroy()
            Settings.Table.PlayerChams[p] = nil
        end
    end)
end

function Watermelon.DisablePlayerChams()
    Settings.State.PlayerChams = false
    
    if Settings.Table.ChamsPlayerAdded then
        Settings.Table.ChamsPlayerAdded:Disconnect()
        Settings.Table.ChamsPlayerAdded = nil
    end
    if Settings.Table.ChamsPlayerRemoving then
        Settings.Table.ChamsPlayerRemoving:Disconnect()
        Settings.Table.ChamsPlayerRemoving = nil
    end
    
    for p, h in pairs(Settings.Table.PlayerChams) do
        if h then h:Destroy() end
        Settings.Table.PlayerChams[p] = nil
    end
    
    for p, conn in pairs(Settings.Table.PlayerChamsConnections) do
        if conn then conn:Disconnect() end
        Settings.Table.PlayerChamsConnections[p] = nil
    end
end

function Watermelon.SummonStand()
    if LocalPlayer.PlayerStats.Stand.Value ~= "None" and not LocalPlayer.Character:FindFirstChild("StandMorph") then
        LocalPlayer.Character:WaitForChild("RemoteEvent"):FireServer("ToggleStand", "Toggle")
    end
end

function Watermelon.CalculatePilotMovement(speed, deltaTime)
    local camera = workspace.CurrentCamera
    local moveVector = Vector3.new(0, 0, 0)
    
    if UserInputService:IsKeyDown(Enum.KeyCode.W) then
        moveVector = moveVector + Vector3.new(camera.CFrame.LookVector.X, 0, camera.CFrame.LookVector.Z)
    end
    if UserInputService:IsKeyDown(Enum.KeyCode.S) then
        moveVector = moveVector - Vector3.new(camera.CFrame.LookVector.X, 0, camera.CFrame.LookVector.Z)
    end
    if UserInputService:IsKeyDown(Enum.KeyCode.D) then
        moveVector = moveVector + Vector3.new(camera.CFrame.RightVector.X, 0, camera.CFrame.RightVector.Z)
    end
    if UserInputService:IsKeyDown(Enum.KeyCode.A) then
        moveVector = moveVector - Vector3.new(camera.CFrame.RightVector.X, 0, camera.CFrame.RightVector.Z)
    end
    
    local velocity = Vector3.new(0, 0, 0)
    local rotation = nil
    
    if moveVector.Magnitude > 0 then
        local unit = moveVector.Unit
        rotation = CFrame.lookAt(Vector3.new(0, 0, 0), unit)
        velocity = unit * speed * deltaTime
    end
    
    return velocity, rotation
end

function Watermelon.EnableStandPilot()
    Settings.State.StandPilot = true
    
    if getgenv().WatermelonStandPilotConnection then
        getgenv().WatermelonStandPilotConnection:Disconnect()
        getgenv().WatermelonStandPilotConnection = nil
    end
    if getgenv().WatermelonStandPilotJumpConnection then
        getgenv().WatermelonStandPilotJumpConnection:Disconnect()
        getgenv().WatermelonStandPilotJumpConnection = nil
    end
    
    if not LocalPlayer.Character:FindFirstChild("StandMorph") then
        Watermelon.SummonStand()
        task.wait(0.5)
    end
    
    if not LocalPlayer.Character:FindFirstChild("StandMorph") then
        Settings.State.StandPilot = false
        return
    end
    
    local stand = LocalPlayer.Character.StandMorph
    local standHumanoid = stand:FindFirstChildWhichIsA("Humanoid")
    local playerHRP = LocalPlayer.Character.HumanoidRootPart
    local playerHumanoid = LocalPlayer.Character.Humanoid
    
    for _, part in LocalPlayer.Character:GetDescendants() do
        if part:IsA("BasePart") then
            part.CanCollide = false
        end
    end
    
    pcall(function()
        for _, part in stand:GetDescendants() do
            if part:IsA("BasePart") or part:IsA("UnionOperation") then
                game:GetService("PhysicsService"):SetPartCollisionGroup(part, "Players")
            end
        end
    end)
    
    if stand.PrimaryPart then
        stand.PrimaryPart.StandAttach:FindFirstChild("AlignOrientation").Enabled = false
        stand.PrimaryPart.StandAttach:FindFirstChild("AlignPosition").Enabled = false
    end
    
    local CameraValue = Instance.new("ObjectValue", LocalPlayer.Character)
    CameraValue.Name = "FocusCam"
    CameraValue.Value = standHumanoid
    
    getgenv().WatermelonStandPilotJumpConnection = playerHumanoid:GetPropertyChangedSignal("Jump"):Connect(function()
        if playerHumanoid.Jump and standHumanoid then
            standHumanoid.Jump = true
            standHumanoid.JumpPower = Settings.Integer.StandPilotJumpPower
        end
        task.wait()
    end)
    
    local lastRotation = nil
    
    getgenv().WatermelonStandPilotConnection = RunService.Heartbeat:Connect(function(deltaTime)
        if not Settings.State.StandPilot then return end
        if not LocalPlayer.Character:FindFirstChild("StandMorph") then
            Settings.State.StandPilot = false
            return
        end
        if not (LocalPlayer.Character and LocalPlayer.Character.Parent and stand and stand.Parent and stand.PrimaryPart) then
            Settings.State.StandPilot = false
            return
        end
        
        if Settings.String.StandPilotMode == "CFrame" then
            local velocity, rotation = Watermelon.CalculatePilotMovement(Settings.Integer.StandPilotSpeed, deltaTime)
            if rotation then
                lastRotation = rotation
            end
            if velocity.Magnitude > 0 and lastRotation then
                local newCFrame = CFrame.new(stand.PrimaryPart.Position + velocity) * lastRotation
                stand.PrimaryPart.CFrame = newCFrame
            end
        else
            if standHumanoid then
                standHumanoid.WalkSpeed = Settings.Integer.StandPilotSpeed
                standHumanoid.JumpPower = Settings.Integer.StandPilotJumpPower
                standHumanoid:Move(workspace.CurrentCamera.CFrame:VectorToObjectSpace(playerHumanoid.MoveDirection), true)
            end
        end
        
        playerHRP.CFrame = stand.PrimaryPart.CFrame - Vector3.new(0, 35, 0)
        playerHRP.Velocity = Vector3.zero
        playerHRP.RotVelocity = Vector3.zero
        playerHRP.AssemblyLinearVelocity = Vector3.zero
        playerHRP.AssemblyAngularVelocity = Vector3.zero
        task.wait()
    end)
    
    getgenv().WatermelonAntiFlingConnection = RunService.Stepped:Connect(function()
        if Settings.State.StandPilot and playerHRP then
            playerHRP.Velocity = Vector3.zero
            playerHRP.RotVelocity = Vector3.zero
            playerHRP.AssemblyLinearVelocity = Vector3.zero
            playerHRP.AssemblyAngularVelocity = Vector3.zero
        end
    end)
end

function Watermelon.DisableStandPilot()
    Settings.State.StandPilot = false
    
    if getgenv().WatermelonStandPilotConnection then
        getgenv().WatermelonStandPilotConnection:Disconnect()
        getgenv().WatermelonStandPilotConnection = nil
    end
    if getgenv().WatermelonStandPilotJumpConnection then
        getgenv().WatermelonStandPilotJumpConnection:Disconnect()
        getgenv().WatermelonStandPilotJumpConnection = nil
    end
    if getgenv().WatermelonAntiFlingConnection then
        getgenv().WatermelonAntiFlingConnection:Disconnect()
        getgenv().WatermelonAntiFlingConnection = nil
    end
    
    if LocalPlayer.Character:FindFirstChild("FocusCam") then
        LocalPlayer.Character.FocusCam:Destroy()
    end
    
    local stand = LocalPlayer.Character:FindFirstChild("StandMorph")
    if stand and stand.PrimaryPart then
        local playerHRP = LocalPlayer.Character.HumanoidRootPart
        if playerHRP then
            playerHRP.AssemblyLinearVelocity = Vector3.zero
            playerHRP.CFrame = stand.PrimaryPart.CFrame
            playerHRP.AssemblyLinearVelocity = Vector3.zero
        end
        
        pcall(function()
            for _, part in stand:GetDescendants() do
                if part:IsA("BasePart") or part:IsA("UnionOperation") then
                    game:GetService("PhysicsService"):SetPartCollisionGroup(part, "Stands")
                end
            end
        end)
        
        stand.PrimaryPart.StandAttach:FindFirstChild("AlignOrientation").Enabled = true
        stand.PrimaryPart.StandAttach:FindFirstChild("AlignPosition").Enabled = true
    end
end

function Watermelon.EnableAutoSteal()
    Settings.State.AutoSteal = true
    
    for _, v in pairs(workspace:GetChildren()) do
        if v:IsA("MeshPart") and v.Name == "Money" then
            task.wait(0.1)
            v.CanCollide = false
            repeat task.wait()
                local hrp = LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("HumanoidRootPart")
                if hrp then
                    v.CFrame = hrp.CFrame
                end
            until not workspace:FindFirstChild("Money")
        end
    end
    
    Settings.Table.AutoStealConnection = workspace.ChildAdded:Connect(function(Child)
        if Child.Name == "Money" and Settings.State.AutoSteal then
            task.wait(0.55)
            Child.CanCollide = false
            repeat task.wait()
                local hrp = LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("HumanoidRootPart")
                if hrp then
                    Child.CFrame = hrp.CFrame
                end
            until not workspace:FindFirstChild("Money")
        end
    end)
end

function Watermelon.DisableAutoSteal()
    Settings.State.AutoSteal = false
    
    if Settings.Table.AutoStealConnection then
        Settings.Table.AutoStealConnection:Disconnect()
        Settings.Table.AutoStealConnection = nil
    end
end

-- COMBAT FUNCTIONS
-- Проверка наличия стенда
function Watermelon.HasStand()
    if LocalPlayer.PlayerStats.Stand.Value == "None" then
        return false
    end
    return LocalPlayer.PlayerStats.Stand.Value
end

function Watermelon.UseMove(move)
    if move == "m1" or move == "m2" then
        LocalPlayer.Character:FindFirstChild("RemoteFunction"):InvokeServer("Attack", move)
    end
end

function Watermelon.Kill(enemy)
    local enemyHRP = enemy:FindFirstChild("HumanoidRootPart")
    local enemyHumanoid = enemy:FindFirstChildWhichIsA("Humanoid")
    local enemyHealth = enemy:FindFirstChild("Health")
    
    local closeRangeStands = {
        "Hermit Purple", "Anubis", "Six Pistols", "Aerosmith", "Mr. President",
        "Beach Boy", "White Album", "Tusk ACT 1", "Scary Monsters",
        "Shadow The World", "Tusk ACT 2", "Tusk ACT 3"
    }
    
    local currentStand = Watermelon.HasStand()
    local useCloseRange = false
    
    if currentStand then
        for _, standName in closeRangeStands do
            if currentStand == standName then
                useCloseRange = true
                break
            end
        end
    end

    if enemy and enemyHRP and enemyHumanoid and enemyHealth and enemyHealth.Value > 0 then
        local playerHRP = LocalPlayer.Character.HumanoidRootPart
        
        getgenv().WatermelonKillAntiFlingConnection = RunService.Stepped:Connect(function()
            if playerHRP then
                playerHRP.Velocity = Vector3.zero
                playerHRP.AssemblyLinearVelocity = Vector3.zero
                playerHRP.AssemblyAngularVelocity = Vector3.zero
            end
        end)
        
        while enemy and enemyHealth and enemyHealth.Value > 0 and enemyHRP and enemyHumanoid do
            enemyHRP = enemy:FindFirstChild("HumanoidRootPart")
            enemyHumanoid = enemy:FindFirstChildWhichIsA("Humanoid")
            enemyHealth = enemy:FindFirstChild("Health")
            if not enemy or not enemyHRP or not enemyHumanoid or not enemyHealth or enemyHealth.Value <= 0 then
                break
            end

            if Watermelon.HasStand() ~= false then
                local summonedStand = LocalPlayer.Character:FindFirstChild("SummonedStand")
                if summonedStand and summonedStand.Value == false then
                    Watermelon.SummonStand()
                end
                
                if useCloseRange then
                    LocalPlayer.Character.PrimaryPart.CFrame = enemyHRP.CFrame - enemyHRP.CFrame.LookVector * 2.3
                else
                    local stand = LocalPlayer.Character:FindFirstChild("StandMorph")
                    if stand and stand.PrimaryPart then
                        stand.PrimaryPart.CFrame = (enemyHRP.CFrame - enemyHRP.CFrame.LookVector * 1.1) + (enemyHRP.Velocity * 0.2)
                        LocalPlayer.Character.PrimaryPart.CFrame = stand.PrimaryPart.CFrame + stand.PrimaryPart.CFrame.LookVector * math.random(-3,-2) + Vector3.new(0,-35,0)
                    end
                end
            else
                LocalPlayer.Character.PrimaryPart.CFrame = enemyHRP.CFrame - enemyHRP.CFrame.LookVector * 2.3
            end

            task.spawn(function()
                Watermelon.UseMove("m1")
            end)

            task.wait()
        end
        
        if getgenv().WatermelonKillAntiFlingConnection then
            getgenv().WatermelonKillAntiFlingConnection:Disconnect()
            getgenv().WatermelonKillAntiFlingConnection = nil
        end
    end
end

function Watermelon.FindNPC(npcName)
    for _, npc in workspace.Living:GetChildren() do
        if npc.Name == npcName and npc:FindFirstChild("HumanoidRootPart") and npc:FindFirstChild("Health") then
            if npc.Health.Value > 0 then
                return npc
            end
        end
    end
    return nil
end

function Watermelon.EnableNPCFarm()
    Settings.State.NPCFarm = true
    
    local hrp = LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("HumanoidRootPart")
    if hrp then
        Settings.Table.SavedPosition = hrp.CFrame
    end
    
    Watermelon.EnableNoClip()
    
    local focusCam = Instance.new("ObjectValue", LocalPlayer.Character)
    focusCam.Name = "FocusCam"
    
    task.spawn(function()
        while Settings.State.NPCFarm do
            for _, npcName in Settings.Table.SelectedNPCs do
                if not Settings.State.NPCFarm then break end
                
                local npc = Watermelon.FindNPC(npcName)
                if npc then
                    local npcHRP = npc:FindFirstChild("HumanoidRootPart")
                    if npcHRP then
                        focusCam.Value = npcHRP
                        Watermelon.Teleport(CFrame.new(npcHRP.Position - Vector3.new(0, 35, 0)))
                        Watermelon.Kill(npc)
                    end
                end
            end
            
            task.wait()
        end
        
        Watermelon.DisableNoClip()
        
        if Settings.Table.SavedPosition then
            Watermelon.Teleport(Settings.Table.SavedPosition)
            Settings.Table.SavedPosition = nil
        end
    end)
end

function Watermelon.DisableNPCFarm()
    Settings.State.NPCFarm = false
    
    if LocalPlayer.Character:FindFirstChild("FocusCam") then
        LocalPlayer.Character.FocusCam:Destroy()
    end
end

LocalPlayer.CharacterAdded:Connect(function(char)
    if Settings.Table.Platform and Settings.Table.Platform.Parent then
        Settings.Table.Platform:Destroy()
        Settings.Table.Platform = nil
    end
    Settings.State.Traveling = false
    
    if Settings.State.Fly then
        task.wait()
        Watermelon.StopFly()
        Watermelon.StartFly()
    end
    
    if Settings.State.Invisibility then
        task.wait()
        Watermelon.DisableInvisibility()
        Watermelon.EnableInvisibility()
    end
end)

local Library = loadstring(game:HttpGet("https://raw.githubusercontent.com/Raw9exe-creator2/SKIDDER/refs/heads/main/AI"))()

local main = Library.new()

local farm_tab = main:create_tab("Autofamrs", "rbxassetid://10734966248")
local player_tab = main:create_tab("Player", "rbxassetid://126017907477623")
local visuals_tab = main:create_tab("Visuals", "rbxassetid://10723346959")
local misc_tab = main:create_tab("Misc", "rbxassetid://10709762058")
local settings_tab = main:create_tab("Settings", "rbxassetid://10723416652")

local itemOptions = {
    "Mysterious Arrow", "Rokakaka", "Gold Coin", "Diamond", "Pure Rokakaka",
    "Quinton's Glove", "Steel Ball", "Rib Cage of The Saint's Corpse",
    "Zepellin's Headband", "Zeppeli's Hat", "Caesar's Headband", "Clackers",
    "Stone Mask", "Ancient Scroll", "Dio's Diary", "Lucky Stone Mask",
    "Lucky Arrow", "Christmas Present"
}

local item_farm = farm_tab:create_module({
    title = "Item Farm",
    flag = "Item_Farm",
    description = "",
    section = "left",
    callback = function(value) end
})

item_farm:create_dropdown({
    title = "Selected Items",
    flag = "Select_Items",
    options = itemOptions,
    multi_dropdown = true,
    callback = function(selected)
        Settings.Table.SelectedItemFarm = selected
    end
})

item_farm:create_slider({
    title = "Item Pickup Delay",
    flag = "Pickup_Delay",
    maximum_value = 1,
    minimum_value = 0.1,
    value = 0.5,
    round_number = false,
    callback = function(value)
        Settings.Integer.PickupDelay = value
    end
})

item_farm:create_checkbox({
    title = "Enable",
    flag = "Enable_Farm",
    callback = function(value)
        Settings.State.ItemFarm = value
        if value then
            Watermelon.EnableInstantPickup()
            Watermelon.EnableInvisibility()
            Watermelon.EnableCamera()
            
            spawn(function()
                while Settings.State.ItemFarm do
                    local item = Watermelon.FindNearestItem(Settings.Table.SelectedItemFarm)
                    
                    if item then
                        local itemPart = item:FindFirstChildOfClass("MeshPart") or item:FindFirstChildOfClass("Part")
                        local proxPrompt = item:FindFirstChild("ProximityPrompt")
                        if itemPart and proxPrompt then
                            local itemName = proxPrompt.ObjectText
                            
                            if Watermelon.IsMax(itemName) then
                                Watermelon.Sell(itemName)
                            end
                            
                            Watermelon.Teleport(itemPart)
                            wait(0.3)
                            fireproximityprompt(proxPrompt)
                            
                            repeat task.wait() until not item.Parent
                        end
                    else
                        Watermelon.TeleportToRandom()
                    end
                end
                
                Watermelon.DisableInvisibility()
                Watermelon.DisableCamera()
            end)
        else
            Watermelon.DisableInstantPickup()
            Watermelon.DisableInvisibility()
            Watermelon.DisableCamera()
            if Settings.Table.Platform and Settings.Table.Platform.Parent then
                Settings.Table.Platform:Destroy()
                Settings.Table.Platform = nil
            end
        end
    end
})

local player_module = player_tab:create_module({
    title = "Invisibility",
    flag = "Player_Module",
    description = "",
    section = "left",
    callback = function(value) end
})

player_module:create_checkbox({
    title = "Enable",
    flag = "Invisibility",
    callback = function(value)
        if value then
            Watermelon.EnableInvisibility()
        else
            Watermelon.DisableInvisibility()
        end
    end
})

local fly_module = player_tab:create_module({
    title = "Flight",
    flag = "Fly_Module",
    description = "",
    section = "left",
    callback = function(value) end
})

fly_module:create_checkbox({
    title = "Enable",
    flag = "Enable_Fly",
    callback = function(value)
        Settings.State.Fly = value
        if value then
            Watermelon.StartFly()
        else
            Watermelon.StopFly()
        end
    end
})

fly_module:create_slider({
    title = "Fly Speed",
    flag = "Fly_Speed",
    maximum_value = 100,
    minimum_value = 1,
    value = 50,
    round_number = true,
    callback = function(value)
        Settings.Integer.FlySpeed = value
    end
})

local stand_pilot_module = player_tab:create_module({
    title = "Stand Pilot",
    flag = "Stand_Pilot_Module",
    description = "",
    section = "right",
    callback = function(value) end
})

stand_pilot_module:create_checkbox({
    title = "Enable",
    flag = "Enable_Stand_Pilot",
    callback = function(value)
        if value then
            Watermelon.EnableStandPilot()
        else
            Watermelon.DisableStandPilot()
        end
    end
})

stand_pilot_module:create_dropdown({
    title = "Pilot Mode",
    flag = "Pilot_Mode",
    options = {"CFrame", "Humanoid"},
    multi_dropdown = false,
    callback = function(selected)
        Settings.String.StandPilotMode = selected
        if Settings.State.StandPilot then
            local stand = LocalPlayer.Character:FindFirstChild("StandMorph")
            if stand and stand.PrimaryPart then
                stand.PrimaryPart.AssemblyLinearVelocity = Vector3.zero
                stand.PrimaryPart.AssemblyAngularVelocity = Vector3.zero
                stand.PrimaryPart.Velocity = Vector3.zero
                stand.PrimaryPart.RotVelocity = Vector3.zero
            end
            local playerHRP = LocalPlayer.Character:FindFirstChild("HumanoidRootPart")
            if playerHRP then
                playerHRP.AssemblyLinearVelocity = Vector3.zero
                playerHRP.AssemblyAngularVelocity = Vector3.zero
                playerHRP.Velocity = Vector3.zero
                playerHRP.RotVelocity = Vector3.zero
            end
            local standHumanoid = stand and stand:FindFirstChildWhichIsA("Humanoid")
            if standHumanoid then
                standHumanoid:Move(Vector3.zero, false)
            end
        end
    end
})

stand_pilot_module:create_slider({
    title = "Pilot Speed",
    flag = "Pilot_Speed",
    maximum_value = 250,
    minimum_value = 16,
    value = 50,
    round_number = true,
    callback = function(value)
        Settings.Integer.StandPilotSpeed = value
    end
})

stand_pilot_module:create_slider({
    title = "Jump Power",
    flag = "Pilot_Jump_Power",
    maximum_value = 200,
    minimum_value = 50,
    value = 50,
    round_number = true,
    callback = function(value)
        Settings.Integer.StandPilotJumpPower = value
    end
})

local esp_module = visuals_tab:create_module({
    title = "Item ESP",
    flag = "ESP_Module",
    description = "",
    section = "left",
    callback = function(value) end
})

esp_module:create_checkbox({
    title = "Enable",
    flag = "Enable_ESP",
    callback = function(value)
        if value then
            Watermelon.EnableItemESP()
        else
            Watermelon.DisableItemESP()
        end
    end
})

esp_module:create_slider({
    title = "Text Size",
    flag = "ESP_TextSize",
    maximum_value = 24,
    minimum_value = 10,
    value = 14,
    round_number = true,
    callback = function(value)
        Settings.Integer.ESPTextSize = value
    end
})

esp_module:create_checkbox({
    title = "Show Distance",
    flag = "ESP_ShowDistance",
    callback = function(value)
        Settings.Bool.ESPShowDistance = value
    end
})

esp_module:create_dropdown({
    title = "Text Font",
    flag = "ESP_TextFont",
    options = {"GothamBold", "Bangers", "Creepster", "PatrickHand", "PermanentMarker", "Jura"},
    multi_dropdown = false,
    callback = function(selected)
        Settings.String.ESPFont = selected
    end
})

esp_module:create_dropdown({
    title = "Select Items",
    flag = "ESP_Items",
    options = itemOptions,
    multi_dropdown = true,
    callback = function(selected)
        Settings.Table.SelectedESPItems = selected
    end
})

local nametag_module = visuals_tab:create_module({
    title = "Player Nametags",
    flag = "Nametag_Module",
    description = "",
    section = "left",
    callback = function(value) end
})

nametag_module:create_checkbox({
    title = "Enable",
    flag = "Enable_Nametags",
    callback = function(value)
        if value then
            Watermelon.EnableNametags()
        else
            Watermelon.DisableNametags()
        end
    end
})

nametag_module:create_slider({
    title = "Text Size",
    flag = "Nametag_TextSize",
    maximum_value = 24,
    minimum_value = 10,
    value = 14,
    round_number = true,
    callback = function(value)
        Settings.Integer.NametagTextSize = value
    end
})

nametag_module:create_checkbox({
    title = "Show Distance",
    flag = "Nametag_ShowDistance",
    callback = function(value)
        Settings.Bool.NametagShowDistance = value
    end
})

nametag_module:create_dropdown({
    title = "Text Font",
    flag = "Nametag_TextFont",
    options = {"GothamBold", "Bangers", "Creepster", "PatrickHand", "PermanentMarker", "Jura"},
    multi_dropdown = false,
    callback = function(selected)
        Settings.String.NametagFont = selected
    end
})

local chams_module = visuals_tab:create_module({
    title = "Player Chams",
    flag = "Chams_Module",
    description = "",
    section = "right",
    callback = function(value) end
})

chams_module:create_checkbox({
    title = "Enable",
    flag = "Enable_Chams",
    callback = function(value)
        if value then
            Watermelon.EnablePlayerChams()
        else
            Watermelon.DisablePlayerChams()
        end
    end
})

local other_module = misc_tab:create_module({
    title = "Other",
    flag = "Other_Module",
    description = "",
    section = "left",
    callback = function(value) end
})

other_module:create_checkbox({
    title = "Instant Pickup",
    flag = "Instant_Pickup",
    callback = function(value)
        if value then
            Watermelon.EnableInstantPickup()
        else
            Watermelon.DisableInstantPickup()
        end
    end
})

other_module:create_checkbox({
    title = "Auto Steal Money",
    flag = "Auto_Steal_Money",
    callback = function(value)
        if value then
            Watermelon.EnableAutoSteal()
        else
            Watermelon.DisableAutoSteal()
        end
    end
})

other_module:create_checkbox({
    title = "Streamer Mode",
    flag = "HideOwnName",
    callback = function(value)
        if value then
            LocalPlayer.PlayerGui.HUD.Playerlist[LocalPlayer.Name].PlayerName.Text = "???"
        else
            LocalPlayer.PlayerGui.HUD.Playerlist[LocalPlayer.Name].PlayerName.Text = LocalPlayer.DisplayName
        end
    end
})

other_module:create_button({
    title = "Jesus Dialogue",
    callback = function()
        LocalPlayer.Character.RemoteEvent:FireServer("PromptTriggered", game.ReplicatedStorage.NewDialogue.Jesus)
    end
})

other_module:create_button({
    title = "Halloween Jack Dialogue",
    callback = function()
        LocalPlayer.Character.RemoteEvent:FireServer("PromptTriggered", game.ReplicatedStorage.NewDialogue:FindFirstChild("Halloween Event"))
    end
})

local weather_module = misc_tab:create_module({
    title = "Ambience",
    flag = "Weather_Module",
    description = "",
    section = "right",
    callback = function(value) end
})

weather_module:create_checkbox({
    title = "Create Fog",
    flag = "Fog",
    callback = function(value)
        local Lighting = game:GetService("Lighting")
        if value then
            if not Lighting:FindFirstChildOfClass("Atmosphere") then
                local Atmosphere = Instance.new("Atmosphere")
                Atmosphere.Density = Settings.Integer.FogDensity or 0.75
                Atmosphere.Color = Color3.fromRGB(199, 199, 199)
                Atmosphere.Decay = Color3.fromRGB(106, 106, 106)
                Atmosphere.Parent = Lighting
                Settings.Table.FogAtmosphere = Atmosphere
            end
        else
            local Atmosphere = Lighting:FindFirstChildOfClass("Atmosphere")
            if Atmosphere then
                Atmosphere:Destroy()
            end
            Settings.Table.FogAtmosphere = nil
        end
    end
})

weather_module:create_slider({
    title = "Fog Range",
    flag = "FogDensity",
    minimum_value = 0,
    maximum_value = 2,
    value = 0.75,
    round_number = false,
    callback = function(value)
        Settings.Integer.FogDensity = value
        if Settings.Table.FogAtmosphere then
            Settings.Table.FogAtmosphere.Density = value
        end
    end
})

local map_module = misc_tab:create_module({
    title = "Perfomance",
    flag = "Map_Module",
    description = "",
    section = "right",
    callback = function(value) end
})

map_module:create_button({
    title = "Destroy Map",
    callback = function()
        for _, v in workspace.Folder:GetDescendants() do
            if v:IsA("BasePart") and not v:IsDescendantOf(workspace.Folder.Roads) and not v:IsDescendantOf(workspace.Folder.Terrain) and not v:IsDescendantOf(workspace.Folder.ParkingGarage) and not v:IsDescendantOf(workspace.Folder.Prison_Bridge) and v.Name ~= "Sewer_Ladders_Part" and not v:IsDescendantOf(workspace.Folder.IMPORTANT.OceanFloor) and v.Name ~= "Ocean" and v.Name ~= "Sidewalk_1" and v.Name ~= "Sidewalk_2" and v.Material ~= Enum.Material.Cobblestone and v.Name ~= "Stairs" and not string.find(v.Name, "Rails") and v.Name ~= "TrainStation_Walkway" and v.Name ~= "TrainStation_Platform" and v.Name ~= "Park_Path" and v.Name ~= "Gravel" and v.Name ~= "Grass" and v.Name ~= "Rock" and v.Name ~= "LowerStairs" and v.Name ~= "UpperStairs" and v.Name ~= "Truss" and not string.find(v.Name, "Grass") and v.Name ~= "Stairs_Step" and not v:IsDescendantOf(workspace.Folder.Prison["Prison_Rails"]) and not v:IsDescendantOf(workspace.Folder.Prison["Prison_Stairs"]) and not v:IsDescendantOf(workspace.Folder.Prison["Prison_Flooring"]) and v.Name ~= "Prison_TopStaircase" and v.Name ~= "Prison_BottomStaircase" and v.Name ~= "Prison_Wall" and v.Name ~= "City_Building_Planks" and v.Name ~= "TrainStation_Under_Brick" and v.Name ~= "TrainStation_Steps" and v.Name ~= "WallPiece_2" and v.Name ~= "Arcade_Interior_Stair" then
                v.Size = Vector3.new(0, 0, 0)
            end
        end
    end
})

local shop_module = misc_tab:create_module({
    title = "Items Shop",
    flag = "Shop_Module",
    description = "",
    section = "right",
    callback = function(value) end
})

local shopItems = {
    {name = "Mysterious Bow ($500)", event = "EndDialogue", data = {NPC = "Mysterious Bow Seller", Dialogue = "Dialogue4", Option = "Option1"}},
    {name = "Pizza ($50)", event = "EndDialogue", data = {NPC = "Pizza", Option = "Option1", Dialogue = "Dialogue2"}, extra = {1, 2}},
    {name = "Tea ($50)", event = "EndDialogue", data = {NPC = "Cafe", Option = "Option1", Dialogue = "Dialogue2"}, extra = {1, 2}},
    {name = "Rokakaka ($2,500)", event = "PurchaseShopItem", data = {ItemName = "1x Rokakaka"}, extra = {1, 2}},
    {name = "Mysterious Arrow ($750)", event = "PurchaseShopItem", data = {ItemName = "1x Mysterious Arrow"}, extra = {1, 2}},
    {name = "Lucky Arrow ($75,000)", event = "PurchaseShopItem", data = {ItemName = "1x Lucky Arrow"}, extra = {1, 2}},
    {name = "DIO's Diary ($20,000)", event = "PurchaseShopItem", data = {ItemName = "1x DIO's Diary"}, extra = {1, 2}},
    {name = "Rib Cage ($3,500)", event = "PurchaseShopItem", data = {ItemName = "1x Rib Cage of The Saint's Corpse"}, extra = {1, 2}},
    {name = "Left Arm ($15,000)", event = "PurchaseShopItem", data = {ItemName = "1x Left Arm of The Saint's Corpse"}, extra = {1, 2}},
    {name = "Pelvis ($45,000)", event = "PurchaseShopItem", data = {ItemName = "1x Pelvis of The Saint's Corpse"}, extra = {1, 2}},
    {name = "Heart ($45,000)", event = "PurchaseShopItem", data = {ItemName = "1x Heart of The Saint's Corpse"}, extra = {1, 2}},
    {name = "Pure Rokakaka ($4000)", event = "PurchaseShopItem", data = {ItemName = "1x Pure Rokakaka"}, extra = {1, 2}}
}

local shopItemNames = {}
for _, item in ipairs(shopItems) do
    table.insert(shopItemNames, item.name)
end

Settings.String.SelectedShopItem = shopItemNames[1]

shop_module:create_dropdown({
    title = "Select Item",
    flag = "Shop_Item",
    options = shopItemNames,
    multi_dropdown = false,
    callback = function(selected)
        Settings.String.SelectedShopItem = selected
    end
})

shop_module:create_button({
    title = "Buy Selected Item",
    callback = function()
        for _, item in ipairs(shopItems) do
            if item.name == Settings.String.SelectedShopItem then
                if item.extra then
                    LocalPlayer.Character.RemoteEvent:FireServer(item.event, item.data, unpack(item.extra))
                else
                    LocalPlayer.Character.RemoteEvent:FireServer(item.event, item.data)
                end
                break
            end
        end
    end
})

local npc_farm_module = farm_tab:create_module({
    title = "NPC Farm",
    flag = "NPC_Farm_Module",
    description = "",
    section = "right",
    callback = function(value) end
})

npc_farm_module:create_checkbox({
    title = "Enable",
    flag = "Enable_NPC_Farm",
    callback = function(value)
        if value then
            Watermelon.EnableNPCFarm()
        else
            Watermelon.DisableNPCFarm()
        end
    end
})

npc_farm_module:create_dropdown({
    title = "Select NPCs",
    flag = "Select_NPCs",
    options = Settings.Table.AllNPCsList,
    multi_dropdown = true,
    callback = function(selected)
        Settings.Table.SelectedNPCs = selected
    end
})

local specs_module = misc_tab:create_module({
    title = "Buy Specs",
    flag = "Specs_Module",
    description = "",
    section = "left",
    callback = function(value) end
})

local specsItems = {
    {name = "William Zeppeli's Hamon [10.000$]", npc = "Lisa Lisa", dialogue = "Dialogue5", option = "Option1"},
    {name = "Jonathan Joestar's Hamon [10.000$]", npc = "Lisa Lisa", dialogue = "Dialogue5", option = "Option2"},
    {name = "Joseph Joestar's Hamon [10.000$]", npc = "Lisa Lisa", dialogue = "Dialogue5", option = "Option3"},
    {name = "Boxing ($10000)", npc = "Quinton", dialogue = "Dialogue5", option = "Option1"},
    {name = "Boxing Gloves ($1000)", npc = "Boxing Gloves", dialogue = "Dialogue1", option = "Option1"},
    {name = "Spin [10.000$]", npc = "Gyro", dialogue = "Dialogue5", option = "Option1"},
    {name = "Vampirism [10.000$]", npc = "Elder Vampire Roomy", dialogue = "Dialogue5", option = "Option1"},
    {name = "Pluck [10.000$]", npc = "Uzurashi", dialogue = "Dialogue5", option = "Option1"},
    {name = "Sword [1.000$]", npc = "Pluck", dialogue = "Dialogue1", option = "Option1"}
}

local specsItemNames = {}
for _, spec in ipairs(specsItems) do
    table.insert(specsItemNames, spec.name)
end

Settings.String.SelectedSpec = specsItemNames[1]

specs_module:create_dropdown({
    title = "Select Spec",
    flag = "Spec_Item",
    options = specsItemNames,
    multi_dropdown = false,
    callback = function(selected)
        Settings.String.SelectedSpec = selected
    end
})

specs_module:create_button({
    title = "Buy Selected Spec",
    callback = function()
        for _, spec in ipairs(specsItems) do
            if spec.name == Settings.String.SelectedSpec then
                LocalPlayer.Character.RemoteEvent:FireServer("EndDialogue", {
                    Dialogue = spec.dialogue,
                    NPC = spec.npc,
                    Option = spec.option
                })
                break
            end
        end
    end
})

local arcade_module = misc_tab:create_module({
    title = "Godmode / Roll Arcade",
    flag = "Arcade_Module",
    description = "",
    section = "left",
    callback = function(value) end
})

arcade_module:create_checkbox({
    title = "Enable",
    flag = "Auto_Roll_Arcade",
    callback = function(value)
        if value then
            Settings.State.AutoArcade = true
            Settings.Table.AutoArcadeConnection = RunService.RenderStepped:Connect(function()
                local RollingItem = LocalPlayer.PlayerGui:FindFirstChild("RollingItem")
                if RollingItem then
                    RollingItem:Destroy()
                end
                if LocalPlayer.PlayerGui:FindFirstChild("RollingItem") == nil then
                    LocalPlayer.Character.RemoteEvent:FireServer("EndDialogue", {
                        NPC = "Item Machine",
                        Option = "Option1",
                        Dialogue = "Dialogue1"
                    })
                end
                task.wait()
            end)
        else
            Settings.State.AutoArcade = false
            if Settings.Table.AutoArcadeConnection then
                Settings.Table.AutoArcadeConnection:Disconnect()
                Settings.Table.AutoArcadeConnection = nil
            end
        end
    end
})

local travel_settings = settings_tab:create_module({
    title = "Travel Settings",
    flag = "Travel_Settings",
    description = "",
    section = "left",
    callback = function(value) end
})

travel_settings:create_slider({
    title = "Stud Delay",
    flag = "Stud_Delay",
    maximum_value = 1,
    minimum_value = 0,
    value = 0.05,
    round_number = false,
    callback = function(value)
        Settings.Integer.StudDelay = value
    end
})

main:load()
